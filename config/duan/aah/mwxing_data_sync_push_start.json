{
  "_id": ObjectID("5d8d84c9956dff0008e9ec68"),
    "name": "冥王星数据同步推送请求处理流",
    "trigger": "mwxing_data_sync_push_start",
    "parameters": [
      "mwxing",
      "mpn",
      "name",
      "d"
    ],
    "follows": [
        {
            "name": "数据推送 - 保存到交换区",
            "trigger": "sas",
            "parameters": [
              "type;push",
              "header;$.parent.parameters.mwxing",
              "from;$.parent.parameters.mpn",
              "data;$.parent.parameters.d"
            ],
            "outputs": [
                "from",
                "header",
                "datas"
            ],
            "next": [
                {
                  "type": "loop",
    							"variable": "data;$.parent.outputs.datas[*]",
    							"start": "0",
    							"end": "size",
    							"task": {
                    "name": "获取交换区数据所述人帐户信息",
                    "trigger": "exc",
                    "parameters": [
                        "method;get",
                        "urlabs;http://sa-aup:8080/aup/data/#{_exchangephoneno}/userinfo?avatar=false",
                        "params;$.parent.outputs.datas[##data_value##]"
                    ],
                    "outputs": [
                        "executed"
                    ],
                    "next": [
                      {
                        "name": "数据复制 - 保存到设备区",
                        "trigger": "sas",
                        "parameters": [
                          "type;copy",
                          "header;$.root.parameters.mwxing",
                          "from;$.root.parameters.mpn",
                          "to;$.parent.parent.outputs.datas[##data_value##]._exchangephoneno",
                          "copyto;$.parent.outputs.executed.response.data",
                          "data;$.parent.parent.outputs.datas[##data_value##].datas"
                        ],
                        "outputs": [
                          "from",
                          "to",
                          "copyto",
                          "header",
                          "datas"
                        ],
                        "next": [
                          {
                            "name": "生成推送数据",
                            "trigger": "acj",
                            "parameters": [
                                "ruleid;MWXING_DATASYNC_V1_5",
                                "datasource;$.parent.outputs",
                                "merge_name;$.root.parameters.name"
                            ],
                            "outputs": [
                                "cleaned"
                            ],
                            "next": [
                              {
                                "type": "loop",
                                "variable": "announce;$.parent.outputs.cleaned.announces[*]",
                                "start": "0",
                                "end": "size",
                                "task": {
                                    "name": "冥王星通知服务",
                                    "trigger": "ann",
                                    "parameters": [
                                        "announceTo;$.parent.outputs.cleaned.announces[##announce_value##].announceTo",
                                        "announceDevice;$.parent.outputs.cleaned.announces[##announce_value##].announceDevice",
                                        "announceType;$.parent.outputs.cleaned.announces[##announce_value##].announceType",
                                        "announceContent;$.parent.outputs.cleaned.announces[##announce_value##].announceContent"
                                    ],
                                    "outputs": [
                                        "result"
                                    ]
                                }
                              }
                            ]
                          }
                        ]
                      }
                    ]
                  }
                },
                {
                  "type": "loop",
    							"variable": "data;$.parent.outputs.datas[*]",
    							"start": "0",
    							"end": "size",
    							"task": {
                    "name": "转换成分类标注处理流程入参格式",
                    "trigger": "acj",
                    "parameters": [
                      "ruleid;MWXING_PUSH_TO_CLASSIFY_V1_5",
                      "datasource;$.parent.outputs.datas[##data_value##]",
                      "merge_pushfrom;$.root.parameters.mpn"
                    ],
                    "outputs": [
                        "cleaned"
                    ],
                    "next": [
                      {
                        "type": "loop",
          							"variable": "requests;$.parent.outputs.cleaned.requests[*]",
          							"start": "0",
          							"end": "size",
          							"task": {
                          "name": "发送活动分类标注请求",
                          "trigger": "exc",
                          "parameters": [
                            "method;post",
                            "urlabs;http://sa-cdc:8080/cdc/mwxing_agenda_classify_start/json/trigger",
                            "data;$.parent.outputs.cleaned.requests[##requests_value##]"
                          ],
                          "outputs": [
                              "executed"
                          ]
                        }
                      }
                    ]
                  }
                }
            ]
        }
    ]
}
